((e,t)=>{for(var s in t)e[s]=t[s]})(window,(e=>{var t={};function s(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=(e,t,o)=>{s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=(e,t)=>{if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,(t=>e[t]).bind(null,n));return o},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,"a",t),t},s.o=(e,t)=>({}.hasOwnProperty.call(e,t)),s.p="https://assets.allegrostatic.com/sc-10556/",s(s.s=0)})({0(e,t,s){e.exports=s("O14P")},GI1G(e){e.exports=JSON.parse('{"a":"https://assets.allegrostatic.com/metrum/icon/arrowhead-9148b8f39c.svg","b":"https://assets.allegrostatic.com/metrum/icon/three-dots-cc8d7d016a.svg"}')},O14P(e,t,s){s.r(t);var o={};function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.r(o),s.d(o,"inbox",()=>r),s.d(o,"inboxLoginButton",()=>a),s.d(o,"messages",()=>i),s.d(o,"message",()=>m),s.d(o,"messageLink",()=>l),s.d(o,"text",()=>c),s.d(o,"messageText",()=>_),s.d(o,"emptyText",()=>d),s.d(o,"guestText",()=>g),s.d(o,"errorText",()=>p),s.d(o,"guestContentWrapper",()=>u),s.d(o,"registerButton",()=>h),s.d(o,"spinner",()=>f),s.d(o,"messageDisplayed",()=>w),s.d(o,"messageNew",()=>y),s.d(o,"messageClicked",()=>b),s.d(o,"messageIcon",()=>v),s.d(o,"messageTime",()=>$),s.d(o,"right9px",()=>x),s.d(o,"messageMenuDropdown",()=>j),s.d(o,"messageMenuDropdownToggle",()=>q),s.d(o,"messageMenuDropdownToggleActive",()=>M),s.d(o,"messageMenuDropdownContentContainer",()=>k),s.d(o,"messageMenuDropdownContent",()=>L),s.d(o,"messageMenuDropdownOpen",()=>z),s.d(o,"messageMenuActions",()=>E),s.d(o,"messageMenuAction",()=>D),s.d(o,"messageMenuActionLink",()=>C),s.d(o,"messageGroup",()=>S),s.d(o,"messageGroupHeader",()=>T),s.d(o,"messageGroupToggle",()=>I),s.d(o,"arrowIcon",()=>A),s.d(o,"messageGroupToggleOpen",()=>N),s.d(o,"messageGroupContentInvisible",()=>G),s.d(o,"messageGroupContent",()=>O),s.d(o,"messageGroupContentVisible",()=>P);var r="mpof_ki myre_zn mr3m_1 m389_6m m7f5_6m _51ce4_3ysel",a="mgn2_14 mp0t_0a m9qz_yo mp7g_oh mse2_40 mqu1_40 mtsp_ib mli8_k4 m3h2_0 munh_0 m911_5r mefy_5r mnyp_5r mdwl_5r msbw_2 mldj_2 mtag_2 mm2b_2 mqvr_2 msa3_z4 mqen_m6 meqh_en m0qj_5r mh36_16 mvrt_16 mg9e_0 mj7a_0 m9tr_pf m2ha_2 m8qd_qh mjt1_n2 bqyr8 mgmw_9u msts_enp mrmn_qo mrhf_u8 m31c_kb m0ux_fp b1bc7 mp4t_16 mryx_32 mpof_vs mupj_5k _51ce4_ERK1D",i="mx4z_5x mr3m_1 m7er_k4 mp4t_0 m3h2_0 mryx_0 munh_0 mg9e_0 mvrt_0 mj7a_0 mh36_0 mdwt_56 _51ce4_3KcyV",m="mp7g_oh mpof_z0 mp4t_0 m3h2_0 mryx_0 munh_0 mg9e_0 mvrt_0 mj7a_0 mh36_0 msts_9u _51ce4_27WWV",l="mpof_ki mli2_1 mj9z_5r m7f5_5x m389_5x _51ce4_3NjUU",c="_1h7wt _9hx3e _51ce4_10wpA",_="_1h7wt _9hx3e _51ce4_yC03d",d="mzmg_6m mgmw_ag mg9e_24 mj7a_24",g="mgmw_ag",p="m7er_56 msts_szl mx4z_5x mg9e_16 mvrt_16 mj7a_16 mh36_16 mp4t_16",u="mzmg_6m mg9e_24 mj7a_24",h="mgn2_14 mp0t_0a m9qz_yo mp7g_oh mse2_40 mqu1_40 mtsp_ib mli8_k4 mp4t_0 m3h2_0 mryx_0 munh_0 m911_5r mefy_5r mnyp_5r mdwl_5r msbw_2 mldj_2 mtag_2 mm2b_2 mqvr_2 msa3_z4 mqen_m6 meqh_en m0qj_5r msts_n7 mh36_16 mvrt_16 mg9e_0 mj7a_0 m9tr_pf m2ha_2 m8qd_qh mjt1_n2 bqyr8 mgmw_vz mrmn_qo mrhf_u8 m31c_kb m0ux_fp boww4 mpof_vs",f="_6gjm5 mp4t_24 m3h2_24 mryx_24 munh_24",w="_51ce4_2yU-d",y="_51ce4_3BP2u",b="_51ce4_1a6Wt",v="mjyo_6x mse2_40 meqh_en msa3_z4 m0s5_e6 isflp mg9e_0 mvrt_0 mj7a_0 mh36_0 mli2_0 _51ce4_20QA1",$="_6x7yn mpof_ki m389_6m _51ce4_ETIEc",x="_51ce4_E6ipK",j="mp7g_f6 mqen_m6 m9tr_5r _51ce4_E6ipK _51ce4_248ly",q="_w7z6o _ypulx m9vn_d2 m9vn_gl_m _51ce4_2e_I7",M="m9vn_d2",k="mp7g_oh",L="mp7g_f6 mpof_5r mjyo_6x mjb5_w6 mg9e_0 mvrt_0 mj7a_0 mh36_0 msts_9u mx7m_1 m911_co mefy_co mnyp_co mdwl_co mlkp_ag mnjl_0 _51ce4_wYIFj",z="_51ce4_3JGSa",E="_3a4zn _12vfa m7er_k4 mzmg_6m mh36_16 mvrt_16 _51ce4_2_Zk-",D="_1bmp9 mryx_0",C="_w7z6o _ypulx mtsp_ib",S="_51ce4_3CcuH",T="mp7g_oh _51ce4_2SLxp",I="mp7g_f6 mqen_m6 _51ce4_E6ipK _51ce4_2xCmc",A="mjyo_6x meqh_en msa3_z4 m0s5_e6 isflp mg9e_0 mvrt_0 mj7a_0 mh36_0 mse2_24 _51ce4_3d2yY",N="_51ce4_337Tu",G="mpof_5r",O="mpof_5r _51ce4_1qkU4 _51ce4_2csNU",P="mpof_z0";const U={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;"},R=/<|>|&|"|'/g,K=(RegExp(Array.from("javascript:",e=>e+"[\\n\\r\\t]*").join(""),"ig"),e=>U[e]);class V{constructor(e,t){this.$=e[0];for(let s=0;s<t.length;s++){const o=t[s];if(Array.isArray(o))for(let e=0;e<o.length;e++)this.$esc(o[e]);else this.$esc(o);this.$+=e[s+1]}}$esc(e){this.$+=e instanceof V?e.$:(e+"").replace(R,K)}toString(){return this.$}}const W=e=>new V([e+""],[]);var Z=(e,...t)=>new V(e,t),H=s("GI1G");const B={"pl-PL":{delete:[["",["Usuń wiadomość"]]],"delete-thread":[["",["Usuń cały wątek"]]],"more-than-month":[["",["ponad miesiąc"]]],ago:[["",["temu"]]],day:[["",["dzień","dni"]]],"hour-short":[["",["godz."]]],"minute-short":[["",["min."]]],sent:[["",["Wysłane"]]],category:[["",["Kategoria"]]],"expand-thread":[["",["Rozwiń wątek"]]],"expand-menu":[["",["Rozwiń menu"]]],"manage-message":[["",["Zarządzaj tą wiadomością"]]],"loading-messages-failed":[["",["Nie mogliśmy wyświetlić Twoich powiadomień."]]],login:[["",["Zaloguj się"]]],register:[["",["Zarejestruj się"]]],"log-in-to-show-messages":[["",["Zaloguj się, aby zobaczyć <br>swoje powiadomienia."]]],"dont-have-account":[["",["Nie masz jeszcze konta?"]]],"no-new-messages":[["",["Nie masz żadnych <br>nowych powiadomień."]]]}},J=/({{[^}]+}}|{%[^%}]+%})/g,Y=/({{[^}]+}})/g,F=/({%[^%}]+%})/g,Q=/({{\s*|\s*}}|{%\s*|\s*%})/g;function X(e,t=""){if("string"==typeof e)throw Error("Translation has to be an array");return e.find(e=>e[0]===t)[1]}const ee=(e,t,s)=>{const o=B["pl-PL"][e];if(!o)throw Error(`Missing translation for lang "pl-PL" and key "${e}"`);return t?((e,t,s)=>{let o=X(e,t.context);return parseInt(t.count,10)>=0?o=((e,t)=>{const s=1==(o=t)?0:o%10>=2&&o%10<=4&&(o%100<10||o%100>=20)?1:2;var o;return"boolean"!=typeof s?e[s]:e[s?1:0]})(o,t.count):[o]=o,((e,t,s)=>{if(s){let s=0;return e.split(J).map(o=>{if(o.match(F)){const n=t.formatters[s];if(n)return s+=1,n(o.replace(Q,""));throw Error(`Missing translation formatter for "${e}"`)}return o.match(Y)?t[o.replace(Q,"")]:o})}const o=e.match(J);let n=0;return o?o.reduce((s,o)=>{const r=o.replace(Q,"");if(o.match(F)){const a=t.formatters[n];if(a)return n+=1,s.replace(o,a(r));throw Error(`Missing translation formatter for "${e}"`)}return o.match(Y)?s.replace(o,t[r]):s},e):e})(o,t,s)})(o,t,s):X(o)[0]},te=(se=o,(...e)=>e.map(e=>se[e]||e).join(" "));var se;let oe,ne,re,ae,ie,me,le,ce,_e,de,ge,pe,ue,he=e=>e;const fe=(we=new Date,e=>`${(e=>{if(e>=2592e3)return ee("more-than-month");if(e>=86400){const t=Math.floor(e/86400);return`${t} ${ee("day",{count:t>1?2:1})}`}return e>=3600?`${Math.floor(e/3600)} ${ee("hour-short")}`:`${Math.max(1,Math.floor(e/60))} ${ee("minute-short")}`})(Math.floor((we-e)/1e3))} ${ee("ago")}`);var we;const ye=Z(oe||(oe=he`<img class="${0}" src="${0}" alt="${0}" width="100%" height="100%" />`),A,H.a,ee("expand-thread")),be=Z(ne||(ne=he`<img class="${0}" src="${0}" alt="${0}" width="100%" height="100%" />`),A,H.b,ee("expand-menu"));function ve({text:e,image:{svg:t},status:s,createdAt:o,tinkerbellId:n,groupId:r},a=!1){const i=te("message","message"+(s.charAt(0)+s.slice(1).toLowerCase()));return Z(ce||(ce=he`<li class="${0}" data-role="message">${0} ${0}</li>`),i,((e,t=!1,s=null)=>Z(me||(me=he`<div class="${0}" data-role="message-actions-dropdown"><button type="button" data-role="message-dropdown" aria-label="${0}" class="${0}">${0}</button><div class="${0}"><div class="${0}">${0}</div></div></div>`),j,ee("manage-message"),q,be,k,L,((e,t,s)=>{const[o,n,r]=e?["action-delete-group",ee("delete-thread"),t]:["action-delete",ee("delete"),s];return Z(ie||(ie=he`<ul class="${0}"><li class="${0}"><button type="button" class="${0}" data-role="${0}" data-id-to-delete="${0}">${0}</button></li></ul>`),E,D,C,o,r,n)})(t,s,e)))(n,a,r),((e,t,s,o)=>Z(le||(le=he`<a data-role="message-link" href="${0}" class="${0}" data-analytics-clickable data-analytics-click-value="${0}">${0}<span><span class="${0}">${0}</span>${0}</span></a>`),"/inbox/redirect/id/"+t,l,s,(e=>Z(ae||(ae=he`<img class="${0}" src="${0}" alt="${0}" width="100%" height="100%" />`),v,e,ee("category")))(o),_,s,W((e=>{const t=new Date(e),s=t.toLocaleDateString(),o=fe(t);return Z(re||(re=he`<time class="${0}" datetime="${0}" aria-label="${0} ${0}">${0}</time>`),$,s,ee("sent"),o,o)})(e))))(o,n,e,t))}const $e=e=>ve(e,!1);function xe(e){if(1===e.length)return $e(e[0]);const[t,...s]=e,o=ve(t,!0),n=s.map($e).join(""),r=Z(_e||(_e=he`<div class="${0}" data-role="message-group-toggle">${0}</div>`),I,ye);return Z(de||(de=he`<li class="${0}"><ol class="${0}">${0} ${0}</ol><ol data-role="message-group-content" class="${0}">${0}</ol></li>`),S,T,W(o),W(r),O,W(n))}function je(e){return"group_"+e}function qe({className:e,content:t}){return Z(pe||(pe=he`<p class="${0} ${0}">${0}</p>`),e,c,W(t))}function Me(){const e=ee("no-new-messages");return qe({className:d,content:e})}function ke(e){const t=ee("log-in-to-show-messages"),s=ee("dont-have-account"),o=qe({className:g,content:t}),n=qe({className:g,content:s}),r="/logowanie?origin_url="+encodeURIComponent(e.location);return Z(ue||(ue=he`<div class="${0}">${0}<a href="${0}" class="${0}" rel="nofollow" data-role="login-button">${0}</a>${0}<a href="${0}" class="${0}" rel="nofollow" data-analytics-clickable data-role="register-button">${0}</a></div>`),u,W(o),r,a,ee("login"),W(n),"/rejestracja",h,ee("register"))}const Le="."+S;class ze{constructor(e,t,s,o){n(this,"onOpen",()=>{this.root.removeEventListener("inViewport",this.onOpen),this.api.getMessages().then(this.onResponse).catch(this.onError)}),n(this,"onResponse",({data:e})=>{const t=(({messages:e})=>e.length>0?(e=>{const t=(e=>{const t=e.reduce((e,t)=>{const s=e,o=t.groupId||t.tinkerbellId;return(s[je(o)]||(s[je(o)]=[])).push(t),s},{});return Object.values(t)})(e).map(xe).join("");return Z(ge||(ge=he`<ul class="${0}" data-role="message-list">${0}</ul>`),i,W(t))})(e):Me())(e);this.setContent(t),this.setupListeners(),this.handleDisplayed(e)}),n(this,"onError",({status:e})=>{const t=401===e?ke(this.window):(()=>{const e=ee("loading-messages-failed");return qe({className:p,content:e})})();this.setContent(t)}),n(this,"setContent",e=>{this.content.innerHTML=e}),n(this,"handleDisplayed",({messages:e})=>{this.services&&this.services.get("opbox-notification-service").then(e=>{e.reset("inboxes")});const t=e.filter(e=>"CLICKED"!==e.status);t.length>0&&this.api.updateStatusToDisplayed(t.map(e=>e.tinkerbellId))}),n(this,"setupListeners",()=>{this.root.querySelectorAll('[data-role="message-group-toggle"]').forEach(e=>e.addEventListener("click",this.toggleGroupVisibility)),this.root.querySelectorAll('button[data-role="message-dropdown"]').forEach(e=>e.addEventListener("click",this.toggleDeleteMessageDropdown)),this.root.querySelectorAll('[data-role="action-delete"]').forEach(e=>e.addEventListener("click",this.singleMessageDeleteListener(e.dataset.idToDelete))),this.root.querySelectorAll('[data-role="action-delete-group"]').forEach(e=>e.addEventListener("click",this.groupMessageDeleteListener(e.dataset.idToDelete)))}),n(this,"toggleDeleteMessageDropdown",e=>{e.preventDefault();const t=e.currentTarget.parentElement.parentElement.querySelector('[data-role="message-actions-dropdown"]'),s=t.classList.contains(z);this.root.querySelectorAll('[data-role="message-actions-dropdown"]').forEach(this.hideActionsDropdown),s||(t.classList.add(z),t.querySelector('button[data-role="message-dropdown"]').classList.add(M))}),n(this,"toggleGroupVisibility",e=>{e.preventDefault();const t=e.currentTarget,s=t.parentElement;if(s){t.classList.toggle(N);const e=s.parentElement.querySelector('[data-role="message-group-content"]');e.classList.toggle(P),e.classList.toggle(G)}}),this.window=e,this.api=t,this.root=s,this.content=s.querySelector('[data-role="inbox"]'),this.services=o}initialize(){null!==(e=>{const t=document.cookie.split(/;\s*/);for(let s=t.length-1;s>=0;s-=1){const[e,o]=t[s].split("=").map(e=>decodeURIComponent(e));if("qeppo_login2"===e)return o}return null})()?this.root.addEventListener("inViewport",this.onOpen):this.setContent(ke(this.window))}groupMessageDeleteListener(e){return t=>{t.stopPropagation(),this.api.deleteGroup(e),this.deleteMessageListItem(t.target.closest(Le)),this.window.opbox.analytics.sendClickEvent({contextNode:this.root,label:"deleteMessageGroup",value:e})}}deleteMessageListItem(e){e.remove(),this.root.querySelectorAll('[data-role="message"]').length||(this.content.innerHTML=Me())}singleMessageDeleteListener(e){return t=>{t.stopPropagation(),this.api.delete(e),this.deleteSingleMessage(t.target.closest('[data-role="message"]')),this.window.opbox.analytics.sendClickEvent({contextNode:this.root,label:"deleteSingleMessage",value:e})}}deleteSingleMessage(e){const t=e.parentNode,s=t.matches('[data-role="message-group-content"]'),o=1===t.childElementCount;s&&o&&this.removeGroupToggleControls(t),this.deleteMessageListItem(e)}removeGroupToggleControls(e){const t=e.parentNode.querySelector('[data-role="message-group-toggle"]');e.remove(),t.remove()}hideActionsDropdown(e){e.classList.remove(z),e.querySelector('button[data-role="message-dropdown"]').classList.remove(M)}}const Ee={withCredentials:!0,headers:{Accept:"application/json","Content-type":"application/json"}},De=Object.assign({},Ee,{headers:Object.assign({},Ee.headers,{"Content-type":"application/vnd.allegro.public.v2+json"})});class Ce{constructor(e){const{opbox:{edge:t}}=e;this.edge=t}getMessages(){return this.edge.get("/inbox/messages",Ee)}updateStatusToDisplayed(e){const t={tinkerbellIdEvents:e.map(e=>({tinkerbellId:e}))};this.edge.post("/inbox/events/displayed",t,De)}delete(e){this.edge.delete("/inbox/messages/"+e,Ee)}deleteGroup(e){this.edge.delete("/inbox/messages/group/"+e,Ee)}}window.opbox.component.register({prototypeName:"allegro.user.inbox"},class{constructor({baseNode:e,services:t}){this.baseNode=e,this.services=t}onMount(){const e=new Ce(window);new ze(window,e,this.baseNode,this.services).initialize()}})}}));
//# sourceMappingURL=index.es6-pl-PL_9929ac08.js.map
var attach=function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&s(o,n.prototype),o}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function d(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function h(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=Object.assign,b=Object.values,y=Object.keys,w=Object.entries,C=Array.from;var E=JSON.parse,k=JSON.stringify;function P(e){return Array.isArray(e)}function x(e){return t(e)}function S(e){return"object"===x(e)&&!P(e)&&null!==e}function I(e){return"string"===x(e)}function N(e){return"undefined"===x(e)}function A(e){return"function"===x(e)}function R(e){return null===e||"object"!==x(e)||0===y(e).length}function M(e,t,n){return e?C(e.querySelectorAll(t),n):[]}function O(e,t){return e?e.querySelector(t):null}function T(e,t){return e.hasAttribute(t)}function V(e,t){return e.getAttribute(t)}function B(e){return V(e,"data-prototype-id")}function j(e){return V(e,"data-box-id")}function W(e){return V(e,"data-box-name")}function U(e){return V(e,"data-civ")}function L(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return g.apply(void 0,[e.createElement(t)].concat(r))}function H(e,t){return e.insertAdjacentElement("beforebegin",t)}function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes("/metrum/")}function D(e){return I(e)?e.split("/metrum/")[1].split("/")[0]:""}function F(){}function _(e,t,n){var r;return function(){for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];var s=this,c=function(){r=null,n||e.apply(s,i)},u=n&&!r;return clearTimeout(r),r=setTimeout(c,t),u&&e.apply(s,i),r}}function q(e,t,n){var r=n.createEvent("CustomEvent");r.initCustomEvent(t,!0,!0,{}),e.dispatchEvent(r)}function G(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if(0===r.length)return e=t;var i=r,a=i.shift();return(e="object"!==x(e)?{}:e)[a]=G.apply(void 0,[e[a],t].concat(i)),e}function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1};y(e).forEach((function(n){Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])&&delete e[n]}))}var X=/Version\/[\d.]+.*Safari/,Y=/iPhone|iPad|iPod|Android/i;var K=function(e){return function(t,n){return Object.assign({},t,{},e(n))}},Q=function(e,t,n){return e.addEventListener(t,n)},$=function(){return Date.now()};function Z(e){return"noModule"in L(e.document,"script")}function ee(e,t){"loading"===e.readyState?Q(e,"DOMContentLoaded",t):t()}function te(e){return e.textContent}var ne=function(e,t,n,r,o,i){var a=new XMLHttpRequest;return a.open(e,t,!0),y(r).forEach((function(e){a.setRequestHeader(e,r[e])})),a.withCredentials=o,a.upload&&i&&Q(a.upload,"progress",i),a.send(function(e,t){return["POST","PUT","PATCH"].includes(e)?"object"!==x(t)||t instanceof Blob||t instanceof FormData?t:k(t):null}(e,n)),a},re=function(e){return e>=200&&e<=204},oe=function(e,t,n,r){var o=e.status,i=e.responseText,a=t(o),s=function(e){return e.split("\n").reduce((function(e,t){var n=t.indexOf(":"),r=t.substr(0,n).trim().toLowerCase(),o=t.substr(n+1).trim();return r&&(e[r]=e[r]?"".concat(e[r],", ").concat(o):o),e}),{})}(e.getAllResponseHeaders()),c={};try{c=E(i)}catch(e){c=i}a?n({status:o,data:c,headers:s}):r({status:o,data:c,message:"Request failed with status code ".concat(o),headers:s})},ie=function(){var e=null,t=function(t,n,r,o){var i=o.headers,a=void 0===i?{}:i,s=o.validateStatus,c=void 0===s?re:s,u=o.withCredentials,l=void 0!==u&&u,d=o.cancelLast,h=void 0!==d&&d,f=o.onUploadProgress;h&&null!==e&&e.abort();var p=ne(t,n,r,a,l,f);return e=p,function(e,t){return new Promise((function(n,r){e.readyState===XMLHttpRequest.DONE?oe(e,t,n,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(oe(e,t,n,r),e.onreadystatechange=null)}}))}(p,c).finally((function(){e=null}))};return{request:t,get:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("GET",e,{},n)},post:function(e,n,r){return t("POST",e,n,r)},put:function(e,n,r){return t("PUT",e,n,r)},patch:function(e,n,r){return t("PATCH",e,n,r)},delete:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("DELETE",e,{},n)}}},ae=function(e){return e.opbox||{}},se=function(e,t){e.opbox=e.opbox||{},g(e.opbox,t)},ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow;n(this,e),this.targetWindow=r}return o(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}(),ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(i,e);var t,r,o=(t=i,r=c(),function(){var e,n=a(t);if(r){var o=a(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return h(this,e)});function i(e){var t;return n(this,i),(t=o.call(this,e)).message=e,t.name="PageRenderingError",t}return i}(l(Error)),le=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,o=t.headers;n(this,e),this.data=r,this.headers=o}return o(e,[{key:"valid",get:function(){return S(this.data)}}]),e}(),de=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.dataSources=t}return o(e,[{key:"resolve",value:function(e,t){var n=e.value;if("DATA_SOURCE"===e.type){var r=this.dataSources[n];return Object.assign({},r&&r.data&&i({},t,r.data),{},r&&!R(r.metadata)&&i({},"".concat(t,".$meta"),r.metadata))}return i({},t,n)}}]),e}(),he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.boxes,o=void 0===r?{}:r,i=t.boxNameToIdMap,a=void 0===i?{}:i,s=t.dataSources,c=void 0===s?{}:s,u=t.meta,l=void 0===u?{}:u;n(this,e),this.boxes=o,this.boxNameToIdMap=a,this.dataSources=c,this.meta=l,this.parameterResolver=new de(c)}return o(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this,t=this.pageProperties;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return y(e).forEach((function(o){r[o]=t.call(n,e[o],o,e)})),r}(this.boxes,(function(n){var r=y(n).reduce((function(t,r){var o=e.parameterResolver.resolve(n[r],r);return g(t,o)}),{});return g(r,t)}))}},{key:"pageProperties",get:function(){var e={};for(var t in this.meta)0===t.indexOf("$page.")&&(e[t]=this.meta[t]);return e}}]),e}();function fe(e,t){var n=new URLSearchParams(e.search);return w(t).map((function(e){var t=f(e,2),r=t[0],o=t[1];return P(o)?(n.delete(r),o.forEach((function(e){return n.append(r,e)}))):n.set(r,o),n})),n}function pe(e){var t=e.href,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL(t);return r.search=fe(r,n).toString(),r.toString()}function ve(e){return e>=200&&e<300||502===e}function me(e){return!!e.match(new RegExp("^(\\/[a-zA-Z0-9\\-]+)*\\/{0,1}$"))}var ge=function(){function e(t){var r=this,o=t.targetWindow,a=void 0===o?window:o,s=t.httpClient,c=t.reportError,u=t.fragmentRenderCallback,l=t.boxRenderCallback;n(this,e),i(this,"renderSubtree",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.boxId,n=e.additionalQueryParameters,o=void 0===n?{}:n,i=e.isPlaceholder,a=void 0!==i&&i;return r.targetWindow.console.warn("Warning: renderSubtree method is deprecated and will be removed soon. Use render.box method instead."),r.renderBox({boxId:t,additionalQueryParameters:o,isPlaceholder:a})})),this.httpClient=s,this.reportError=c,this.targetWindow=a,this.fragmentRenderCallback=u,this.boxRenderCallback=l,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this)}}return o(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:ve};return this.httpClient.get(e,t).then((function(e){var t=new le(e);if(!t.valid)throw new ue("Opbox response is invalid.");return new he(t.data)}))}},{key:"handleError",value:function(e){return this.reportError(new Error(e)),Promise.reject(e)}},{key:"renderBox",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxId,r=t.additionalQueryParameters,o=void 0===r?{}:r,i=t.isPlaceholder,a=void 0!==i&&i;return n?this.httpClient.get(pe(this.targetWindow.location,o),{headers:{Accept:"application/vnd.opbox-web.subtree+json","x-box-id":n},cancelLast:!1,validateStatus:ve}).then((function(t){var r=t.data;return e.boxRenderCallback({boxId:n,data:r,isPlaceholder:a})})):this.handleError("Missing 'boxId' property!")}},{key:"renderFragment",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pathname,r=t.additionalQueryParameters,o=void 0===r?{}:r;if(!n)return this.handleError("Missing 'pathname' property!");if(!me(n))return this.handleError("Invalid 'pathname' property!");var i=this.targetWindow.location,a=i.protocol,s=i.host,c=new URL("".concat(a,"//").concat(s).concat(n)),u=c.href;return this.httpClient.get(pe({href:u},o),{headers:{Accept:"application/vnd.opbox-web.subtree+json"},cancelLast:!1,validateStatus:ve}).then((function(t){var r=t.data;return e.fragmentRenderCallback({pathname:n,data:r})}))}},{key:"createAPI",value:function(){return{renderSubtree:this.renderSubtree,render:this.render}}}]),e}(),be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.meta,o=void 0===r?{}:r,i=arguments.length>1?arguments[1]:void 0;n(this,e),this.appContext=i,this.meta=o}return o(e,[{key:"updateMetaRobots",value:function(){var e=O(this.appContext.document,'head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),ye=function(){function e(t){var r=this,o=t.appContext,a=t.analytics,s=t.updateComponentCallback,c=void 0===s?F:s,u=t.beforeUpdateComponentCallback,l=void 0===u?F:u;n(this,e),i(this,"registerListener",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F;if(r.rawData.boxes[e]){var o=r.rawData.resolved.boxes[e];setTimeout((function(){t(o)}),0)}r.listeners[e]={onChange:t,onProgress:n}})),this.appContext=o,this.rawData=new he,this.listeners={},this.analytics=a,this.updateComponentCallback=c,this.beforeUpdateComponentCallback=l}return o(e,[{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,r=n.boxes,o=n.boxNameToIdMap,i=n.meta,a=i.defaultCustomParams;this.analytics&&this.analytics.updateCustomParams(a),w(r).forEach((function(e){var n=f(e,2),r=n[0],o=n[1];N(o)||t.updateComponentCallback(r,o)})),y(o).forEach((function(e){var n=r[o[e]];if(!N(n)){var i=t.listeners[e];i&&A(i.onChange)&&setTimeout((function(){return i.onChange(n)}),0)}})),new be({meta:i},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),y(this.listeners).forEach((function(t){var n=e.listeners[t];n&&A(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var we=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}function t(n,r){var o=n,i=r;e(n)||(o={}),e(r)||(i={});var a=Object.keys(o),s=Object.keys(i),c={};return a.forEach((function(n){-1!==s.indexOf(n)?null===o[n]?c[n]=i[n]:e(o[n])&&e(i[n])?c[n]=t(o[n],i[n]):c[n]=i[n]:c[n]=o[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(c[e]=i[e])})),c}return function(n){var r=n;e(n)||(r={});for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return i.forEach((function(n){e(n)&&(r=t(r,n))})),r}}()})),Ce=function(e){return M(e,"[".concat("data-analytics-enabled","]"))},Ee=function(e){var t=M(e,"[".concat("data-analytics-proxied","]")).reduce((function(e,t){var n,r=Ce(t).filter((function(t){return!e.includes(t)}));return r.length?(n=r,e.concat(n)):e}),[]);return Ce(e).filter((function(e){return!t.includes(e)}))},ke=new WeakMap,Pe=new WeakMap,xe=function(e){return ke.has(e)},Se=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&!xe(e)){var r=parseInt(Pe.get(e),10)||0,o=r+t;o>=n&&(ke.set(e,!0),q(e,"boxView",e.ownerDocument)),Pe.set(e,o)}},Ie=function(e,t,n,r){return e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:r},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return e.slice(0,t)},Ae=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.targetWindow,a=r.send;n(this,e),i(this,"handleError",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.error,r=void 0===n?{}:n,o=r.name,i=r.message,a=r.stack;t.counter<100&&(t.counter+=1,t.send({type:o,message:Ne(i,800),stack:Ne(a,800)}))})),this.window=o,this.send=a,this.counter=0}return o(e,[{key:"initialize",value:function(){Q(this.window,"error",this.handleError)}}]),e}(),Re=function(e,t){for(var n,r={},o=0;o<e.attributes.length;o+=1){var i=e.attributes[o];if(0===i.name.indexOf(t)){var a=i.name.replace(t,"");r[(n=a,n.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()})))]=i.value}}return r},Me=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,o=Re(t,"data-analytics-view-opbox-custom-"),i=y(o).length?{_opbox:o}:{};return we(Re(t,"data-analytics-view-custom-"),i,r)},Oe=function(e){var t=e.contextNode,n=e.coordinates,r=void 0===n?{}:n,o=e.destinationUrl,i=void 0===o?"":o,a=e.customParams,s=void 0===a?{}:a,c=e.isNewTab,u=c?{isNewTab:c}:{},l=Object.assign({},Re(t,"data-analytics-click-opbox-custom-"),{destinationUrl:i},u,{},r);return we(Re(t,"data-analytics-click-custom-"),{_opbox:l},s)},Te=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,o=Re(t,"data-analytics-interaction-custom-"),i=Re(t,"data-analytics-interaction-opbox-custom-"),a=y(i).length?{_opbox:i}:{};return we(o,a,r)},Ve=function(e){var t=e.closest("[".concat("data-analytics-tags","]"));if(!t)return[];var n,r,o,i,a=!!t.closest("[".concat("data-item","]"))?function(e){var t=e&&e.closest("[".concat("data-box-name","][").concat("data-analytics-tags","]"));return t&&V(t,"data-analytics-tags")||""}(t):"",s=V(t,"data-analytics-tags")||"";return n=s,r=a.split(","),o=n.split(","),(i=r.concat(o)).filter((function(e,t){return e&&i.indexOf(e)===t}))},Be=function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(V(t,"data-analytics-groups"));try{n=E(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]},je=function(e,t,n){return Q(e,t,n),function(){e.removeEventListener(t,n)}},We=function(){function e(t){var r=this,o=t.targetWindow,a=t.config,s=t.cookieMonsterClient,c=t.boxViewsMarker,u=t.sendPerformanceMetrics;n(this,e),i(this,"sendPingEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,n=e.scrollBottom,o=e.pageHeight,i={category:"Engagement",label:"ping",customParams:{et:t,sb:n,ph:o}};r.cookieMonsterClient.send("event",i),r.callEventCallbacks(i)})),i(this,"sendErrorEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.message,o=e.stack,i={category:"BrowserError",label:t,value:n,customParams:{st:o}};r.cookieMonsterClient.send("event",i),r.callEventCallbacks(i)})),i(this,"detectAdblock",(function(){var e=r.document,t=L(e,"div",{innerHTML:"&nbsp;",className:"adsbox"});e.body.appendChild(t),r.targetWindow.setTimeout((function(){var n=0!==t.offsetHeight;r.cookieMonsterClient.send("event",{category:"clearPV",action:n,customParams:r.defaultCustomParams.ev}),e.body.removeChild(t)}),100)})),i(this,"handleClick",(function(e){r.handleBoxInteraction(e),r.handleLinkClick(e)})),i(this,"handleLinkClick",(function(e){if(A(e.target.closest))if(r.shouldHandleBoxInteraction(e))r.handleBoxInteraction(e);else{var t=e.target.closest("a");if(t&&T(t,"data-analytics-clickable")){var n=V(t,"data-analytics-click-label")||"",o=V(t,"data-analytics-click-value")||te(t).trim(),i="_blank"===V(t,"target"),a=V(t,"href"),s=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&r.sendClickEvent({contextNode:t,label:n,value:o,customParams:Oe({contextNode:t,coordinates:s,destinationUrl:a,isNewTab:!0})}):r.sendContextmenuEvent({contextNode:t,label:n,value:o,customParams:Oe({contextNode:t,coordinates:s,destinationUrl:a})}):r.sendClickEvent({contextNode:t,label:n,value:o,customParams:Oe({contextNode:t,coordinates:s,destinationUrl:a,isNewTab:i||e.metaKey||e.ctrlKey})})}}})),i(this,"handleChange",(function(e){var t=e.target;if("select-one"===t.type&&t&&T(t,"data-analytics-selectable")){var n=t.options[t.selectedIndex].value,o=Re(t,"data-analytics-select-custom-");r.sendEvent({contextNode:t,action:"change",value:n,customParams:o})}})),i(this,"handleSubmit",(function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&T(t,"data-analytics-submittable")){var n=V(t,"action"),o=C(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),i=(o=o?"?".concat(o):"")?n+o:n;i=encodeURI(i),r.sendFormSubmitEvent({contextNode:t,value:i,label:"submitForm"})}})),i(this,"handleBoxView",(function(e){var t=e.target;if(t&&T(t,"data-analytics-enabled")&&!C(t.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))){var n=V(t,"data-analytics-view-value")||"",o=V(t,"data-analytics-view-label")||"",i=Me({contextNode:t});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(i=Object.assign({},i,{},Re(t.firstChild,"data-analytics-view-custom-"))),T(t,"data-item"))return r.markParentBoxAsVisible(t),void r.sendItemViewEvent({contextNode:t,label:o,value:n,customParams:i});i=Object.assign({},i,{},function(e){if(!e)return{};var t=V(e,"data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=E(decodeURIComponent(t))}catch(e){console.log(e)}return n}(t)),r.sendBoxViewEvent({contextNode:t,value:n,customParams:i})}}));var l=a.cookieMonster,d=(l=void 0===l?{}:l).account,h=l.isEngagementMeasuringEnabled,f=l.isErrorReporterEnabled,p=l.defaultCustomParams,v=void 0===p?{}:p;this.targetWindow=o,this.document=o.document,this.account=d,this.isEngagementMeasuringEnabled=h,this.isErrorReporterEnabled=f,this.cookieMonsterClient=s,this.boxViewsMarker=c,this.defaultCustomParams=v,this.eventCallbacks=[],this.sendPerformanceMetrics=u||F,this.errorReporter=new Ae({targetWindow:o,send:this.sendErrorEvent});var m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=(t=void 0===t?{}:t).userAgent,r=void 0===n?"":n;return r}(o);this.isMobile=function(e){return!!e.match(Y)}(m),this.isSafari=function(e){return!!e.match(X)}(m),this.isFirefox=function(e){return e.toLowerCase().includes("firefox")}(m)}return o(e,[{key:"initialize",value:function(){var e=this;if(this.account){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&Promise.resolve().then((function(){return Lt})).then((function(t){(0,t.attachEngagementObserver)({targetWindow:e.targetWindow,onCycleComplete:e.sendPingEvent})})),this.isErrorReporterEnabled&&this.errorReporter.initialize();var t=this.document;this.eventHandlers=[je(t,"change",this.handleChange),je(t,"click",this.handleClick),je(t,"mousedown",this.handleLinkClick),je(t,"submit",this.handleSubmit),je(t,"contextmenu",this.handleClick),je(t,"boxView",this.handleBoxView),je(this.targetWindow,"DOMContentLoaded",this.detectAdblock)]}}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e()}))}},{key:"callEventCallbacks",value:function(e){this.eventCallbacks.length&&this.eventCallbacks.forEach((function(t){return t(e)}))}},{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextNode,n=e.action,r=e.label,o=void 0===r?"":r,i=e.value,a=e.customParams,s=void 0===a?{}:a;if(!t||!n)return{};var c=t.closest("[data-analytics-category]").getAttribute("data-analytics-category"),u=W(t.closest("[data-box-name]")),l=t.closest("[data-box-id]"),d=l&&j(l),h=Ve(t),f=Be(t),p=h.length?{analyticsTags:h}:{},v=f.length?{groups:f}:{},m=d?{boxName:u,boxId:d}:{boxName:u},g=Object.assign({},p,{},v,{},m),b=we(Object.assign({},s),{_opbox:g},this.defaultCustomParams.ev),y={category:c,action:n,label:o,value:i,customParams:b};return this.cookieMonsterClient.send("event",y),this.callEventCallbacks(y),y}},{key:"sendClickEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}},{key:"handleBoxInteraction",value:function(e){if(A(e.target.closest)){var t=e.target.closest("[data-analytics-interaction]");if(t){var n=Te({contextNode:t}),r=V(t,"data-analytics-interaction-label")||"",o=V(t,"data-analytics-interaction-value")||te(t).trim();this.sendBoxInteractionEvent({contextNode:t,label:r,value:o,customParams:n})}}}},{key:"shouldHandleBoxInteraction",value:function(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!xe(t)&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"sendPageViewProxy",value:function(){this.account&&(this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer())}},{key:"sendEventProxy",value:function(e,t,n,r,o){return this.account?e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:n,label:o,action:t,contextNode:e,customParams:r}):this.sendEvent(e):null}},{key:"sendItemViewEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams;this.account&&this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:Me({contextNode:t,customParams:o})})}},{key:"sendClickEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams,i=e.destinationUrl,a=e.isNewTab;if(this.account){if(a&&"boolean"!==x(a))throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:t,label:n,value:r,customParams:Oe({contextNode:t,destinationUrl:i,customParams:o,isNewTab:a})})}}},{key:"sendContextmenuEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams,i=e.destinationUrl;this.account&&this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:Oe({contextNode:t,destinationUrl:i,customParams:o})})}},{key:"sendBoxInteractionEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,o=e.customParams;this.account&&this.sendBoxInteractionEvent({contextNode:t,label:n,value:r,customParams:Te({contextNode:t,customParams:o})})}},{key:"updateCustomParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pv,n=void 0===t?{}:t,r=e.ev,o=void 0===r?{}:r;S(n)&&S(o)?this.defaultCustomParams={pv:n,ev:o}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){this.account&&e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}]),e}();function Ue(e){return S(e)&&!("clientImplementationVersion"in e)?g(e,{clientImplementationVersion:""}):e}function Le(e){var t=e.instance,n=e.method,r=e.reportError,o=e.data,i=void 0===o?null:o,a=e.onSuccess,s=void 0===a?function(){}:a;if(t&&A(t[n]))try{t[n](i),s()}catch(e){r(e)}}function He(e){return P(e)?e.map(Ue):Ue(e)}function ze(e,t){return""===t?e:"".concat(e,"@").concat(t)}var De=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.targetWindow,a=r.services,s=r.reportError,c=r.unmountNodeCallback,u=r.mountNodeCallback,l=r.componentNodesFinder,d=r.serializedPropsFinder,h=r.registerPrototypeCallback;n(this,e),i(this,"unmountNode",(function(e){t.unmountNodeCallback(e),M(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=j(e)||W(e);Le({instance:t.instances.get(n),method:"onUnmount",reportError:t.reportError}),t.instances.set(n,null)}))})),i(this,"mountNode",(function(e){M(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=B(e),r=U(e)||"";t.registerInstancesForPrototype(n,r,[e])})),t.mountNodeCallback(e)})),i(this,"updateComponentCallback",(function(e,n){var r=t.instances.get(e);r?Le({instance:r,method:"onUpdate",reportError:t.reportError,data:n}):t.boxDataCache.set(e,n)})),i(this,"beforeUpdateComponentCallback",(function(){t.instances.forEach((function(e){return Le({instance:e,method:"beforeOnUpdate",reportError:t.reportError})}))})),i(this,"register",(function(e,n){var r=He(e);t.isPrototypeValid(r)&&t.isImplementationValid(n)&&(P(r)?r.forEach((function(e){t.registerImplementationAndInstances(e,n)})):t.registerImplementationAndInstances(r,n))})),this.targetWindow=o,this.services=a,this.implementations=new Map,this.instances=new Map,this.boxDataCache=new Map,this.reportError=s,this.unmountNodeCallback=c,this.mountNodeCallback=u,this.registerPrototypeCallback=h,this.serializedPropsFinder=d,this.componentNodesFinder=l}return o(e,[{key:"isPrototypeObjectValid",value:function(e){var t=e.prototypeName,n=e.clientImplementationVersion;return"prototypeName"in e?""===t?(this.reportError(new Error('Property "prototypeName" cannot be empty string')),!1):I(t)?!!I(n)||(this.reportError(new Error('Property "clientImplementationVersion" must be string but got '.concat(x(n)))),!1):(this.reportError(new Error('Property "prototypeName" must be string but got '.concat(x(t)))),!1):(this.reportError(new Error('Property "handledPrototype" must have "prototypeName" field')),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError(new Error("Empty handledPrototypes list")),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return P(e)?this.containsValidPrototypes(e):S(e)?this.isPrototypeObjectValid(e):(this.reportError(new Error('"handledPrototype" argument must be an object or an array')),!1)}},{key:"isImplementationValid",value:function(e){return A(e)?e.prototype.onUpdate&&!A(e.prototype.onUpdate)?(this.reportError(new Error('"onUpdate" property must be a function or undefined but got '.concat(x(e.prototype.onUpdate)))),!1):!!A(e.prototype.onMount)||(this.reportError(new Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(new Error('"implementation" must be a class')),!1)}},{key:"registerInstancesForPrototype",value:function(e,t,n){var r=this.implementations.get(ze(e,t));r&&(this.registerInstances(n,this.services.getServicesForComponent(e),r),this.registerPrototypeCallback(e,t))}},{key:"registerImplementationAndInstances",value:function(e,t){var n=e.prototypeName,r=e.clientImplementationVersion,o=ze(n,r),i=""===r;this.implementations.has(o)?this.reportError(new Error("".concat(n," ").concat(i?"":"with ".concat(r," client implementation version "),"already registered!"))):(this.implementations.set(o,t),this.registerInstancesForPrototype(n,r,this.componentNodesFinder.find(n,r)))}},{key:"registerInstances",value:function(e,t,n){var r=this;e.forEach((function(e){if(!V(e,"data-pathname")){var o=W(e),i=j(e),a=r.serializedPropsFinder.getPropsForBox(i,o),s=new n({baseNode:e,props:a,services:t}),c=i||o;r.instances.get(c)||(Le({instance:s,method:"onMount",reportError:r.reportError,onSuccess:function(){r.instances.set(c,s)}}),r.boxDataCache.has(c)&&(Le({instance:s,method:"beforeOnUpdate",reportError:r.reportError}),r.updateComponentCallback(c,r.boxDataCache.get(c)),r.boxDataCache.delete(c)))}}))}},{key:"createPublicAPI",value:function(){return{register:this.register}}},{key:"createPrivateAPI",value:function(){var e=this;return{updateComponentCallback:this.updateComponentCallback,beforeUpdateComponentCallback:this.beforeUpdateComponentCallback,unmountNode:this.unmountNode,mountNode:this.mountNode,updateSerializedPropsCollection:function(){e.serializedPropsFinder.updateNodesCollection()},updateComponentNodesCollection:function(){e.componentNodesFinder.updateNodesCollection()}}}}]),e}(),Fe="script[".concat("data-serialize-box-id","], script[").concat("data-serialize-box-name","]"),_e=function(){function e(t,r){n(this,e),this.targetWindow=t,this.reportError=r,this.collection=[],this.updateNodesCollection()}return o(e,[{key:"updateNodesCollection",value:function(){this.collection=M(this.targetWindow.document,Fe)}},{key:"getNodeByBoxId",value:function(e){return this.collection.find((function(t){return V(t,"data-serialize-box-id")===e}))}},{key:"getNodeByBoxName",value:function(e){return this.collection.find((function(t){return V(t,"data-serialize-box-name")===e}))}},{key:"getPropsFromNode",value:function(e){if(!e)return{};try{return E(te(e))}catch(e){return this.reportError(e),{}}}},{key:"getPropsForBox",value:function(e,t){var n=this.getNodeByBoxId(e)||this.getNodeByBoxName(t);return n?this.getPropsFromNode(n):{}}}]),e}(),qe=function(e,t){return function(e,n){var r=e.prototypeName;r&&n({domNodes:t.find(r)})}},Ge=["Content-Type"],Je=function(){return Promise.reject(new Error("missing edge host"))},Xe=function(){function e(t){var r=this,o=t.httpClient,a=t.edgeHost,s=t.language;n(this,e),i(this,"get",(function(e,t){return r.httpClient.get(r.prepareRequestUrl(e),r.prepareRequestSettings(t,!0))})),i(this,"put",(function(e,t,n){return r.httpClient.put(r.prepareRequestUrl(e),t,r.prepareRequestSettings(n))})),i(this,"post",(function(e,t,n){return r.httpClient.post(r.prepareRequestUrl(e),t,r.prepareRequestSettings(n))})),i(this,"patch",(function(e,t,n){return r.httpClient.patch(r.prepareRequestUrl(e),t,r.prepareRequestSettings(n))})),i(this,"delete",(function(e,t){return r.httpClient.delete(r.prepareRequestUrl(e),r.prepareRequestSettings(t,!0))})),this.edgeHost=a,this.httpClient=o,this.defaultHeaders={"Content-Type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json","Accept-Language":s}}return o(e,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.disableDefaultHeaders)return e;var n=this.normalizeSettings(e),r=this.defaultHeaders,o=(r["Content-Type"],d(r,Ge));return we({},t?{headers:o}:{headers:this.defaultHeaders},n)}},{key:"normalizeSettings",value:function(e){if(!e||!e.headers)return e;var t=function e(t,n){return y(t).reduce((function(r,o){var i=t[o],a="object"===x(i)?e(i,n):i;return r[n.find((function(e){return o.toLowerCase()===e.toLowerCase()}))||o]=a,r}),{})}(e.headers,y(this.defaultHeaders));return g(e,{headers:t})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"createAPI",value:function(){return this.edgeHost?{get:this.get,put:this.put,post:this.post,patch:this.patch,delete:this.delete}:{get:Je,put:Je,post:Je,patch:Je,delete:Je}}}]),e}();function Ye(e){var t=e.targetWindow,n=e.alias,r=void 0===n?"cm":n,o=e.config,i=void 0===o?{}:o,a=i.cookieMonster,s=a.host,c=a.account,u=a.defaultCustomParams,l=void 0===u?{}:u,d=t.document,h=function(){return A(t[r])},f=function(){if(!h()){t["cm.analytics.object"]=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(C(arguments))};var e=d.createElement("script");e.src=s,d.head.appendChild(e)}};function p(){h()&&t[r].apply(null,C(arguments))}function v(){var e="send@".concat(c);p.apply(null,[e].concat(C(arguments)))}var m=i.cookieMonster.referrer||d.referrer,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.pv||{};v("pageview",{customParams:e,referrer:m})},y=function(){m=window.location.href};g(this,{initialize:function(){s&&c&&!h()?(f(),p("create",c),b(),y()):y()},updateReferrer:y,send:v,sendPageView:b})}var Ke=function(){function e(t){var r,o,a,s,c=this,u=t.targetWindow,l=t.boxes,d=void 0===l?[]:l,h=t.significantElementSizePercentage,f=void 0===h?.75:h,p=t.timeoutValue,v=void 0===p?500:p,m=t.debounceTimeoutValue,g=void 0===m?20:m;n(this,e),i(this,"markCurrentlyVisibleElementsAsSeen",(function(){var e=c.config.timeoutValue;c.visibleElements.forEach((function(t){Se(t,e,e)}))})),i(this,"intersectionHandler",(function(e){e.forEach((function(e){var t=e.target,n=e.boundingClientRect,r=e.rootBounds;r&&function(e,t,n){var r=e.right-e.left,o=e.bottom-e.top,i=Ie(e.left,e.right,t.width,r);return Ie(e.top,e.bottom,t.height,o)*i/(r*o)>n}(n,r,c.config.significantElementSizePercentage)?(c.visibleElementsByIntersectionObserver.add(t),c.notVisibleElements.delete(t),q(t,"inViewport",c.document)):c.visibleElementsByIntersectionObserver.has(t)?(c.visibleElementsByIntersectionObserver.delete(t),q(t,"outOfViewport",c.document)):c.notVisibleElements.add(t)})),c.resetCurrentlyVisibleElementsOnTimeout()})),i(this,"scrollHandler",(function(){c.state.isScrolling||(c.state.scrollStartTime=(new Date).getTime(),c.state.isScrolling=!0),clearTimeout(c.markCurrentlyVisibleElementsAsSeenOnTimeout()),c.scrollEndHandler()})),i(this,"addBox",(function(e){null!==e&&-1===c.boxes.indexOf(e)&&(c.boxes.push(e),c.observer.observe(e))})),i(this,"isBoxInViewport",(function(e){return c.visibleElementsByIntersectionObserver.has(e)})),i(this,"markBoxAsRendered",(function(e){return T(e,"data-analytics-enabled")&&c.addBox(e),Ee(e).forEach(c.addBox),Promise.resolve()})),i(this,"markBoxAsVisible",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.addBox(e),t){var n=c.config.timeoutValue;Se(e,n,n)}})),i(this,"recursivelyMarkBoxAsVisible",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c.markBoxAsVisible(e,t),Ee(e).forEach((function(e){return c.markBoxAsVisible(e,t)}))})),i(this,"removeBox",(function(e,t){null!==e&&(!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&ke.delete(e),Pe.delete(e)}(e,t),c.boxes=c.boxes.filter((function(t){return t!==e})),c.visibleElements=c.visibleElements.filter((function(t){return t!==e})),c.observer.unobserve(e))})),i(this,"markBoxAsHidden",(function(e){c.removeBox(e,!1),c.resetCurrentlyVisibleElementsOnTimeout()})),i(this,"unmountNode",(function(e){Ce(e).forEach(c.removeBox)})),i(this,"recursivelyMarkBoxAsHidden",(function(e){c.markBoxAsHidden(e),Ee(e).forEach(c.markBoxAsHidden)})),i(this,"trackBoxScroll",(function(e){Q(e,"scroll",c.scrollHandler)})),this.targetWindow=u,this.document=u.document,this.config={timeoutValue:v,debounceTimeoutValue:g,significantElementSizePercentage:f},this.resetState(),this.boxes=d.length?d:Ee(u.document),this.visibleElements=[],this.visibleElementsByIntersectionObserver=new Set,this.notVisibleElements=new Set,this.observer=new u.IntersectionObserver(this.intersectionHandler,{threshold:f}),this.scrollEndHandler=_(this.resetCurrentlyVisibleElementsAfterScroll,g),this.resetCurrentlyVisibleElementsOnTimeout=(r=this.resetCurrentlyVisibleElements.bind(this),o=g,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this;return new Promise((function(e){var n=a&&!s;clearTimeout(s),s=setTimeout((function(){s=null,a||e(r.apply(i,t))}),o),n&&e(r.apply(i,t))}))}),this.markCurrentlyVisibleElementsAsSeenOnTimeout=_(this.markCurrentlyVisibleElementsAsSeen,v)}return o(e,[{key:"resetState",value:function(){var e=$();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=$();this.visibleElements.forEach((function(n){Se(n,t-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){Se(t,e.state.scrollStartTime-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"resetCurrentlyVisibleElements",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeen(),this.visibleElements=[],this.visibleElementsByIntersectionObserver.forEach((function(t){return e.visibleElements.push(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.notVisibleElements.forEach((function(t){e.observer.unobserve(t),e.observer.observe(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"initialize",value:function(){var e=this;Q(this.targetWindow,"scroll",this.scrollHandler),this.boxes.forEach((function(t){return e.observer.observe(t)}))}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered,markBoxAsVisible:this.markBoxAsVisible,recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible,markBoxAsHidden:this.markBoxAsHidden,recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden,trackBoxScroll:this.trackBoxScroll,isBoxInViewport:this.isBoxInViewport}}}]),e}(),Qe=function(e){return function(t){0===t.status||(e.newrelic?(console.error("Reporting error to newrelic: ".concat(t.message)),e.newrelic.noticeError(t)):console.error("Error: ".concat(t.message)),e.opbox.plugin.get("sentry").then((function(e){return e.captureException(t)})).catch(F))}};function $e(e){for(var t,n,r,o,i=new RegExp("([^&=]+)=?([^&]*)","g"),a={},s=e.substring(e.indexOf("?")+1,e.length);t=i.exec(s);)n=a,r=decodeURIComponent(t[1]),o=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[r]?n[r]=[o]:n[r].push(o);return a}function Ze(e){var t,n="";return new URLSearchParams((t=e,y(t).flatMap((function(e){return t[e].map((function(t){return[e,t]}))})))).forEach((function(e,t){if("null"!==e&&"undefined"!==e&&!N(e)){var r=n?"&":"?",o=encodeURIComponent(t),i=encodeURIComponent(e);n="".concat(n).concat(r).concat(o,"=").concat(i)}})),n}var et=function(e,t){var n,r=$e(e),o=r.route;function i(e){t.forEach((function(t){return n=e,r=t.name,o=t.value,void(n[r]=P(o)?o:[o]);var n,r,o}))}if(o&&o.startsWith("http")){var a=f(o.split("?"),2),s=a[0],c=a[1];i(n=c?$e(c):[]),o=s+Ze(n)}else i(r);return Ze(r)},tt=function(){function e(t){var r=this,o=t.targetWindow,a=t.opboxWebClient,s=t.rawDataListenersRegistry,c=t.reportError;n(this,e),i(this,"navigateRelative",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.persistHash,o=void 0!==n&&n,i=r.location,a=i.pathname,s=i.search,c=i.hash,u=o?c:"",l=a+s+u,d=e.filter((function(e){return!e.fetchUrlOnly})),h=et(s,d),f=et(s,e),p=a+h+u,v=a+f+u;return v!==r.lastFetchPath&&r.fetch(v),p!==l&&(r.changeUrl(p),r.history.push(a),r.changeCallbacks.forEach((function(e){return e()})),r.targetWindow.performance.mark("clientSideNavigationStart")),p})),i(this,"refreshPage",(function(){var e=r.location,t=e.pathname+e.search;r.fetch(t)})),i(this,"changeState",(function(e){var t=e.queryParameters,n=e.hash,o=e.shouldChangeHistory;if(!t&&!I(n))return r.reportError(new Error("New parameters (array) or hash (string) required")),null;var i,a=r.location,s=a.pathname,c=a.search,u=a.hash,l=s+c+u,d=I(n)?""===(i=n)||"#"===i[0]?i:"#".concat(i):u,h=s+et(c,t||[])+d;if(h!==l){var f=o?"pushState":"replaceState";r.targetWindow.history[f]("","",h),r.changeStateCallbacks.forEach((function(e){return e()}))}return h})),i(this,"registerChangeCallback",(function(e){r.registerCallback(e,r.changeCallbacks)})),i(this,"registerChangeStateCallback",(function(e){r.registerCallback(e,r.changeStateCallbacks)}));var u=o.location,l=u.pathname,d=u.search;this.targetWindow=o,this.location=o.location,this.opboxWebClient=a,this.rawDataListenersRegistry=s,this.reportError=c,this.history=[l],this.lastFetchPath=l+d,this.changeCallbacks=[],this.changeStateCallbacks=[]}return o(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"changeUrl",value:function(e){this.targetWindow.history.pushState("","",e)}},{key:"handlePopState",value:function(e){var t=e.target.location,n=t.pathname,r=n+t.search;this.isInternalNavigation(n)&&this.lastFetchPath!==r&&this.refreshPage()}},{key:"fetch",value:function(e){var t=this;this.lastFetchPath=e,this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then((function(e){return t.rawDataListenersRegistry.triggerChangeListener(e)})).catch(Qe)}},{key:"registerCallback",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];A(e)?t.push(e):this.reportError(new Error('First argument must be a function but got "'.concat(x(e),'"')))}},{key:"createAPI",value:function(){return{registerChangeCallback:this.registerChangeCallback,registerChangeStateCallback:this.registerChangeStateCallback,changeState:this.changeState}}}]),e}(),nt="opboxAnimationTimerInterval",rt=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},ot=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function it(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=o.duration,a=void 0===i?500:i,s=o.onFinish;if(!A(r))return null;var c=ot(e),u=$(),l=n-t,d=!1,h=function(){d=!0},f=function e(){var n=$()-u;if(d||n>=a)A(s)&&s(),d=!1;else{var o=Math.min(n/a,1),i=rt(o)*l+t;r(i),c(e)}};return f(),{stop:h}}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,o=void 0===r?500:r,i=e.pageYOffset,a=Math.max(0,t),s=e.document.body.scrollHeight;function c(t){var n=t===a||t===a,r=e.innerHeight+t>=s;return n||r}function u(){e[nt]&&A(e[nt].stop)&&(e[nt].stop(),e[nt]=null)}var l=function(t){e.scrollTo(0,Math.round(t)),c(t)&&u()};u(),e[nt]=it(e,i,t,l,{duration:o})}var st=function(){function e(){var t=this;n(this,e),this.status=1,this.promise=new Promise((function(e){t.resolve=e}))}return o(e,[{key:"registerImplementation",value:function(e){this.status=2,this.resolve(e)}}]),e}(),ct=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.reportError,a=r.allowedPlugins,s=void 0===a?[]:a;n(this,e),i(this,"addPluginToRegistry",(function(e){var n=e.name;t.isPluginAvailable(n)||t.pluginsRegistry.set(n,new st)})),i(this,"register",(function(e,n){if(e){var r=e.name;if(I(r))if(r)if(n)if(t.isPluginAvailable(r)){var o=t.pluginsRegistry.get(r);2!==o.status?o.registerImplementation(n):t.reportRegistrationError('Plugin "'.concat(r,'" is already registered on page'),!0)}else t.reportRegistrationError('Plugin "'.concat(r,'" is not allowed to register on this page'));else t.reportRegistrationError('Second argument "implementation" is required');else t.reportRegistrationError('Property "name" should be a non-empty string');else t.reportRegistrationError('Property "name" should be a string')}else t.reportRegistrationError('First argument "config" should be defined')})),i(this,"getPlugin",(function(e){return t.isPluginAvailable(e)?t.pluginsRegistry.get(e).promise:Promise.reject(new Error('Plugin "'.concat(e,'" is unavailable')))})),i(this,"updateRegistry",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach(t.addPluginToRegistry)})),this.reportError=o,this.pluginsRegistry=new Map,this.boundUpdateRegistry=this.updateRegistry,this.updateRegistry(s)}return o(e,[{key:"isPluginAvailable",value:function(e){return this.pluginsRegistry.has(e)}},{key:"reportRegistrationError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Error("Plugin registration error. ".concat(e));t?console.error(n):this.reportError(n)}},{key:"createAPI",value:function(){return{register:this.register,get:this.getPlugin}}}]),e}();function ut(e,t){return function(n){if(!e.has(n))return Promise.reject(new Error("Service ".concat(n," is not registered")));var r=e.get(n);return r.fetchIfNotFetched(t),r.promise}}var lt=function(){function e(t){var r=this,o=t.prototypeName,i=t.servicesRegistry,a=t.targetWindow;n(this,e),this.services=new Map,this.targetWindow=a,i.forEach((function(e,t){e.components.some((function(e){return e.prototypeName===o}))&&r.services.set(t,e)})),this.get=ut(this.services,a)}return o(e,[{key:"has",value:function(e){return this.services.has(e)}}]),e}();function dt(e,t){return t.filter((function(t){return!e.find((n=t,function(e){if(n.url)return[e.url,e.href,e.src].includes(n.url);if(n.code){var t=n.attributes,r=void 0===t?{}:t,o=!y(r).some((function(t){return r[t]!==V(e.node,t)}));return n.code===e.code&&o}return!1}));var n}))}function ht(e,t,n){if(!t.length)return Promise.resolve();var r=function(e){return C(e.document.getElementsByTagName("script"),(function(e){return{src:e.src,code:e.innerHTML,nonce:e.nonce,node:e}}))}(e),o=function(e){return(e.find((function(e){return!!e.nonce}))||{}).nonce}(r),i=dt(r,t);return Promise.all(i.map(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F,r=e.document,o=Qe(e),i=Z(e);return function(e){var a=e.url,s=e.code,c=e.attributes,u=e.type,l=e.async;return a||s?new Promise((function(e){var d,h=!a&&!!s,p="module"===u,v=L(r,"script"),m=!1,g=function t(n){e(),n.message||(n.message="Error while loading script: ".concat(a)),o(n),v.removeEventListener("error",t)};if(!p||i){if(c){if(c.nomodule&&i)return void e();w(c).forEach((function(e){var t=f(e,2),n=t[0],o=t[1];"data-serialize-box-id"!==n&&"data-serialize-box-name"!==n||(m=!0,d=O(r,"[".concat(n,'="').concat(o,'"]'))),v.setAttribute(n,o)}))}t&&v.setAttribute("nonce",t),l&&v.setAttribute("async","async"),u&&(v.type=u),h?(v.innerHTML=s,e()):(v.src=a,Q(v,"load",(function t(){e(),v.removeEventListener("error",g),v.removeEventListener("load",t)})),Q(v,"error",g)),d?d.parentNode.replaceChild(v,d):r.body.appendChild(v),m&&n()}else e()})):Promise.resolve()}}(e,o,n)))}var ft=function(){function e(t){var r=this,o=t.assetUrl,i=t.components,a=t.reportError;n(this,e),this.assetUrl=o,this.components=i,this.reportError=a,this.implementation=null,this.status=0,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return o(e,[{key:"update",value:function(e){this.components=function(e,t){return t.reduce((function(e,t){return e.find((function(e){return e.prototypeName===t.prototypeName}))?e:e.concat(t)}),e)}(this.components,e)}},{key:"registerImplementation",value:function(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(e){this.handleError(e)}}},{key:"fetchIfNotFetched",value:function(e){var t=this;0===this.status&&(this.status=1,ht(e,[{url:this.assetUrl}]).catch((function(e){t.handleError(e)})))}},{key:"handleError",value:function(e){this.reportError(e),this.status=2,this.reject()}}]),e}(),pt=function(){function e(t){var r=this,o=t.targetWindow,a=t.reportError;n(this,e),i(this,"update",(function(e){e.forEach((function(e){var t=f(e,2),n=t[0],o=t[1],i=o.assetUrl,a=o.components;r.servicesRegistry.has(n)?r.servicesRegistry.get(n).update(a):r.setServiceToRegistry(n,i,a)}))})),i(this,"register",(function(e,t){var n=e.serviceName;r.servicesRegistry.get(n).registerImplementation(t)})),this.targetWindow=o,this.reportError=a,this.servicesRegistry=new Map;var s=O(o.document,'script[data-config="services"]');if(s)try{E(te(s)).forEach((function(e){var t=f(e,2),n=t[0],o=t[1],i=o.assetUrl,a=o.components;r.setServiceToRegistry(n,i,a)}))}catch(e){a(e)}this.dangerouslyGet=ut(this.servicesRegistry,o)}return o(e,[{key:"getServicesForComponent",value:function(e){return new lt({prototypeName:e,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}},{key:"setServiceToRegistry",value:function(e,t,n){this.servicesRegistry.set(e,new ft({assetUrl:t,components:n,reportError:this.reportError}))}},{key:"createAPI",value:function(){return{register:this.register,__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}]),e}();function vt(e,t){e.forEach((function(e){var n=e.args,r=e.reject,o=e.resolve,i=function(e,t){try{return e.apply(void 0,p(t))}catch(e){return void console.error(e)}}(t,n);i&&A(i.then)&&A(o)&&A(r)&&i.then(o,r)}))}var mt=function(){return Date.now()};var gt=function e(t){var r=this,o=t.localStorage,a=t.reportError,s=t.ttlMs,c=void 0===s?2592e6:s,u=t.key,l=void 0===u?"opbox.preferences":u,d=t.timeProvider,h=void 0===d?mt:d;n(this,e),i(this,"savePreferences",(function(e){var t=r.loadPreferences(),n=r.timeProvider(),o=e.reduce(K((function(e){return i({},e.name,{value:e.value,timestamp:n})})),t);r.writeToStorage(o)})),i(this,"writeToStorage",(function(e){try{r.storage.setItem(r.key,k(e))}catch(e){r.reportError(e)}})),i(this,"loadPreferences",(function(){try{return E(r.storage.getItem(r.key))||{}}catch(e){return r.reportError(e),{}}})),i(this,"cleanupPreferences",(function(){var e=r.loadPreferences(),t=r.timeProvider(),n=w(e).reduce(K((function(e){var n=f(e,2),o=n[0],a=n[1];return a.timestamp+r.ttlMs>t?i({},o,a):{}})),{});r.writeToStorage(n)})),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(o)?o:{setItem:function(){},getItem:function(){return{}}},this.ttlMs=c,this.key=l,this.timeProvider=h,this.reportError=a},bt=["Content-Type"],yt={withCredentials:!0,headers:{"Content-Type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},wt=function(){function e(t){var r=this,o=t.edgeClient,a=t.localStorage,s=t.ttlMs,c=t.reportError;n(this,e),i(this,"setPreference",(function(e,t){var n={name:e,value:t};return r.storage.savePreferences([n]),r.edgeClient.post("/preferences",n,yt)})),i(this,"getPreference",(function(e,t){return I(e)||e instanceof String?r.getPreferences(i({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))})),i(this,"setPreferences",(function(e){if(!S(e))return Promise.reject(Error("illegal argument type provided as preferences"));var t=w(e).map((function(e){var t=f(e,2);return{name:t[0],value:t[1]}}));return r.storage.savePreferences(t),r.edgeClient.post("/preferences/multi",k(t),yt)})),i(this,"getPreferences",(function(e){if(!S(e))return Promise.reject(Error("illegal argument type provided as preferences"));var t=y(e).join(","),n="".concat("/preferences","?name=").concat(t),o=yt.withCredentials,a=yt.headers,s=(a["Content-Type"],d(a,bt));return r.edgeClient.get(n,{withCredentials:o,headers:s}).then((function(e){var t=e.data.preferences;return r.storage.savePreferences(t),t.reduce(K((function(e){return i({},e.name,e.value)})),{})})).catch((function(){return r.getPreferencesFromLocalStorageOrDefaults(e)}))})),i(this,"getPreferencesFromLocalStorageOrDefaults",(function(e){r.storage.cleanupPreferences();var t=r.storage.loadPreferences();return w(e).reduce(K((function(e){var n=f(e,2),r=n[0],o=n[1];return i({},r,r in t?t[r].value:o)})),{})})),this.edgeClient=o,this.storage=new gt({localStorage:a,ttlMs:s,reportError:c})}return o(e,[{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,setMany:this.setPreferences,getMany:this.getPreferences}}}]),e}();function Ct(e,t){var n=e.document,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.inHead,i=void 0!==o&&o,a=r.referenceNode,s=void 0===a?null:a;return function(e){if(R(e))return null;J(e,(function(e,t){return!t}));var r=L(n,"link",e,{rel:t});s?H(s,r):n[i?"head":"body"].appendChild(r);return r}}var Et=["spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","tabs","typography","color","grid","calendar","attachment","article","navigation-tiles","pin","player-video","align","border","box-sizing","display","flex","height","margin","padding","position","transition","utils","visibility","white-space","width","zindex","core"];var kt,Pt=function(e){return function(t){return-1!==t.href.indexOf(e)}};function xt(e,t){return e.findIndex((function(e){return e.selectorText===t}))}function St(e,t,n){var r=t.cssBundle,o=r.isEnabled,i=r.emptyRule,a=o?function(e){return C(e.document.styleSheets).find((function(e){var t=e.ownerNode;return t&&T(t,"data-metrum-bundle")}))}(e):null,s=[],c=function(e){return i.pattern.replace(i.replacementPart,e)};return{isEnabled:o,inject:function(t){if(!o)return Promise.resolve();var r,i,u,l,d,h,p=function(e,t){return t.reduce((function(t,n){var r=f(t,2),o=r[0],i=r[1];return e.includes(n)||i.push(n),o.push(n),[o,i]}),[[],[]])}(s,t),v=f(p,2),m=v[0],g=v[1];return s=m,g.length?(r=e.document,i=g,u=r.createDocumentFragment(),l=L(r,"div"),d=function(){r.body.removeChild(l)},h=i.map((function(e){return new Promise((function(t,n){var o=L(r,"link",{type:"text/css",rel:"stylesheet",crossOrigin:"",href:e,media:"not all"});Q(o,"load",(function(){t(o.sheet)})),Q(o,"error",n),l.appendChild(o)}))})),u.appendChild(l),r.body.appendChild(u),Promise.all(h).then((function(e){return[e,d]}))).then((function(e){var t=f(e,2),r=t[0],o=t[1];r.forEach((function(e){var t=C(a.cssRules),r=t.length;if(!function(e,t){return t.cssRules.length>0&&e.findIndex((function(e){return e.cssText===t.cssRules[0].cssText}))>-1}(t,e)){for(var o=D(e.href),i=n.indexOf(o),s=-1!==i?n.slice(i):[],u=r,l=0;l<s.length;l+=1){var d=xt(t,c(s[l]));if(d>0){u=d;break}}var h=C(e.cssRules);h.unshift({cssText:"".concat(c(o),"{}")});for(var f=0;f<h.length;f+=1)a.insertRule(h[f].cssText,u+f)}})),o()})):Promise.resolve()}}}function It(e,t,n,r){var o=n.href,i=n.media,a=D(o);return r.includes(a)?function(e,t,n){var r=t.href,o=t.media,i=Ct(e,"stylesheet",{inHead:!0,referenceNode:n})({type:"text/css",href:r,media:o});return new Promise((function(e,t){Q(i,"error",t),Q(i,"load",e)}))}(e,{href:o,media:i},function(e,t,n){var r=e.filter((function(e){return e.isMetrum})),o=t.slice(0,t.indexOf(n)).reverse().find((function(e){return r.find(Pt(e))})),i=o?r.find(Pt(o)).node:null;return!i&&r.length?r[0].node.previousElementSibling:!i&&e.length?e[0].node.previousElementSibling:i}(t,r,a)):Promise.resolve()}function Nt(e,t,n){var r=e.document.createDocumentFragment(),o=n.map((function(n){var o=n.url,i=n.code,a=n.media;if(z(o))return It(e,t,{href:o,media:a},Et);if(o){var s=L(e.document,"link",Object.assign({type:"text/css",rel:"stylesheet",crossorigin:"",href:o},a?{media:a}:{}));return r.appendChild(s),new Promise((function(e,t){s.addEventListener("error",(function(){return t(new Error("Loading external styles failed"))})),s.addEventListener("load",e)}))}return i?(r.appendChild(L(e.document,"style",{textContent:i})),Promise.resolve()):Promise.reject(new Error("Given styles have empty code/href"))}));return e.document.head.appendChild(r),Promise.all(o)}function At(e,t,n){if(!t.length)return Promise.resolve();var r=[].concat(p(M(e.document,'link[type="text/css"],style',(function(e){return{href:e.href,code:e.innerHTML,media:e.media,node:e,isMetrum:z(e.href)}})).filter((function(e){var t=e.href,n=e.code;return t||n}))),p(function(e,t,n){var r=[],o=O(e,n.selectors.bundledStylesMap);if(!o)return r;try{return E(te(o))}catch(e){return t(new Error("Bundled styles map: invalid JSON")),r}}(e.document,Qe(e),n))),o=dt(r,t),i=kt=kt&&!kt.forceRefresh?kt:St(e,n,Et),a=i.inject,s=i.isEnabled,c=f(o.reduce((function(e,t){return z(t.url)&&s?(e[0].push(t.url),e):(e[1].push(t),e)}),[[],[]]),2),u=c[0],l=c[1];return Promise.all([Nt(e,r,l),a(u)])}function Rt(e){var t=e.targetWindow,n=e.webResponse,r=e.config,o=n.svgColorMatrixFilters,i=void 0===o?"":o,a=n.assets,s=a.styles,c=void 0===s?[]:s,u=a.prefetches,l=void 0===u?[]:u,d=a.preloads,h=void 0===d?[]:d;return function(e,t){var n=e.document;if(t){var r=O(n,"#svg-color-matrix-filters"),o=O(L(n,"div",{innerHTML:t}),"svg");r?M(o,"filter",(function(e){O(r,"#".concat(V(e,"id")))||r.appendChild(e)})):n.body.insertBefore(o,n.body.firstChild)}}(t,i),h.forEach(Ct(t,"preload")),l.forEach(Ct(t,"prefetch")),At(t,c,r)}function Mt(e){var t=e.targetWindow,n=e.webResponse,r=e.lazyScriptsManager,o=e.updateSerializedPropsCollectionCallback,i=n.assets.scripts,a=f((void 0===i?[]:i).reduce((function(e,t){return t.lazyDownload?e[0].push(t):e[1].push(t),e}),[[],[]]),2),s=a[0];return ht(t,a[1],o).then((function(){return r.handleSubtreeAssets(s)}))}var Ot=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,o=e.mountNodeCallback,i=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Rt:u,d=e.injectScripts,h=void 0===d?Mt:d,f=e.lazyScriptsManager,p=n.document;function v(e){return O(p,'[data-box-id="'.concat(e,'"]'))}return function(e){var u=e.boxId,d=e.data,m=e.isPlaceholder,g=d.htmlString,b=d.servicesConfig,y=d.allowedPlugins;return i(b),a(y),l({targetWindow:n,webResponse:d,config:t}).then((function(){var e=m?function(e){return O(p,'[data-placeholder-for="'.concat(e,'"]'))}(u):v(u);if(r(e),!g)return e.parentNode.removeChild(e),!1;var t=L(p,"div",{innerHTML:g});return e.parentNode.replaceChild(t.firstElementChild,e),!0})).then((function(e){c(),h({targetWindow:n,webResponse:d,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&o(v(u))}))}))}},Tt=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,o=e.mountNodeCallback,i=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Rt:u,d=e.injectScripts,h=void 0===d?Mt:d,f=e.lazyScriptsManager,p=n.document;function v(e){return O(p,'[data-pathname="'.concat(e,'"]'))}function m(e,t){var n=L(p,"div",{innerHTML:t});return n.setAttribute("data-pathname",e),n}return function(e){var u=e.pathname,d=e.data,g=d.htmlString,b=d.servicesConfig,y=d.allowedPlugins;return i(b),a(y),l({targetWindow:n,webResponse:d,config:t}).then((function(){var e=v(u);if(!e&&g){var t=m(u,g);return p.body.appendChild(t),!0}if(e){if(r(e),!g)return e.parentNode.removeChild(e),!1;var n=m(u,g);return e.parentNode.replaceChild(n,e),!0}return!1})).then((function(e){c(),h({targetWindow:n,webResponse:d,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&o(v(u))}))}))}},Vt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e+t},Bt=function(){function e(t,r){var o=this;n(this,e),i(this,"observerEntriesHandler",(function(e){e.forEach((function(e){if(e.isIntersecting){var t=e.target.dataset,n=t.civ,r=t.prototypeId,i=o.getDependencyMapEntry(r,n),a=Vt(r,n);o.isDownloaded(a)||(o.markAsDownloaded(a),o.unobserveAllUnderKey(a),ht(o.targetWindow,i.scripts))}}))})),i(this,"onPrototypeRegistered",(function(e,t){var n=Vt(e,t),r=o.unhandledClicks[n];if(o.registered.push(n),r){var i=function(e){var t=e.navigator,n=t.connection,r=t.mozConnection,o=t.webkitConnection;return n||r||o}(o.targetWindow),a=i?" Connection: ".concat(i.effectiveType,", ").concat(i.downlink,"Mbps"):"";o.errorReporter(new Error("Lazy scripts: ".concat(r,' unhandled clicks registered for "').concat(e,"@").concat(t,'" before its script was downloaded.').concat(a)))}})),this.targetWindow=t,this.observedElements={},this.downloaded=[],this.registered=[],this.dependencyMapCache=[],this.observer=null,this.errorReporter=Qe(t),this.componentNodesFinder=r,this.unhandledClicks={}}return o(e,[{key:"createObserverInstance",value:function(){this.observer=new this.targetWindow.IntersectionObserver(this.observerEntriesHandler,{rootMargin:"800px",threshold:0})}},{key:"markAsDownloaded",value:function(e){this.downloaded.push(e)}},{key:"isDownloaded",value:function(e){return this.downloaded.includes(e)}},{key:"markAsRegistered",value:function(e){this.registered.push(e)}},{key:"isRegistered",value:function(e){return this.registered.includes(e)}},{key:"observeElement",value:function(e,t){this.observedElements[t]=[].concat(p(this.observedElements[t]||[]),[e]),this.observer.observe(e)}},{key:"unobserveAllUnderKey",value:function(e){var t=this;this.observedElements[e].forEach((function(e){return t.observer.unobserve(e)}))}},{key:"getDependencyMapEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.dependencyMapCache.find((function(n){var r=n.prototypeId,o=n.clientImplementationVersion;return r===e&&(void 0===o?"":o)===t}))}},{key:"addDependencies",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;t.getDependencyMapEntry(n,r)||t.dependencyMapCache.push(e)}))}},{key:"observeComponents",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion,o=t.componentNodesFinder.find(n,r);if(o.length){var i=Vt(n,r);o.forEach((function(e){t.observeElement(e,i),t.watchForUnhandledClicks(e,i)}))}else t.errorReporter(new Error('Lazy scripts: DOM reference not found for "'.concat(n,"@").concat(r,'"')))}))}},{key:"filterDownloadedScripts",value:function(e){var t=this;return e.filter((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;return!t.isDownloaded(Vt(n,r))}))}},{key:"watchForUnhandledClicks",value:function(e,t){var n=this;Q(e,"click",(function(){n.isRegistered(t)||(n.unhandledClicks[t]=(n.unhandledClicks[t]||0)+1)}))}},{key:"handleSSRAssets",value:function(){var e=this,t=this.targetWindow.document;ee(t,(function(){e.dependencyMapCache=function(e,t){var n=O(e,'script[data-config="lazy-scripts-map"]'),r=[];if(!n)return r;try{return E(te(n))}catch(e){return t(new Error("Lazy scripts: incorrect dependency map JSON")),r}}(t,e.errorReporter),R(e.dependencyMapCache)||(e.createObserverInstance(),e.observeComponents(e.dependencyMapCache))}))}},{key:"handleSubtreeAssets",value:function(e){var t=this,n=this.filterDownloadedScripts(e);if(!R(n)){var r=function(e){return b(e.reduce((function(e,t){var n=t.prototypeId,r=t.clientImplementationVersion,o=Vt(n,r),i=e[o];return i?(i.scripts.push(t),e):(e[o]={prototypeId:n,clientImplementationVersion:r,scripts:[t]},e)}),{}))}(n);this.addDependencies(r),this.observer||this.createObserverInstance(),setTimeout((function(){return t.observeComponents(r)}),0)}}}]),e}(),jt=function(){function e(t){n(this,e),this.document=t.document,this.collection=[],this.updateNodesCollection()}return o(e,[{key:"updateNodesCollection",value:function(){this.collection=M(this.document,"div[data-prototype-id]")}},{key:"find",value:function(e,t){return t?this.collection.filter((function(n){return B(n)===e&&U(n)===t})):this.collection.filter((function(t){return B(t)===e}))}}]),e}(),Wt=new(function(){function e(t,r,o){var a=this;n(this,e),i(this,"domReadyHelper",(function(e){"loading"===a.document.readyState?ee(a.document,e):a.targetWindow.setTimeout(e,0)})),i(this,"lazyloadedElement",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=V(t,"data-placeholder-for");n&&a.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})})),i(this,"attach",(function(){var e,t,n=ae(a.targetWindow),r=a.API;n&&(!function e(t,n,r){for(var o=arguments.length,i=new Array(o>3?o-3:0),a=3;a<o;a++)i[a-3]=arguments[a];if(A(t)&&A(n)){if(!t.__queue__)return;vt(t.__queue__,n),r.apply(void 0,[n].concat(i))}else S(t)&&S(n)&&y(t).forEach((function(o){e.apply(void 0,[t[o],n[o],r].concat(p(i.concat(o))))}))}(n,r,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return se(a.targetWindow,G.apply(void 0,[n,e].concat(r)))})),e=n,t=y(r).concat("initialized","config"),J(e,(function(e){return!t.includes(e)})),Object.freeze(n)),a.broadcastAPILoadEvent(),Q(a.targetWindow,"lazyloaded",a.lazyloadedElement),a.updateInlinePreference(),r.performance.markTimeToInteractive("@allegro/opbox-web-browser")})),i(this,"sendPerformanceMetrics",(function(){var e=a.targetWindow.pinter;e&&e.sendUserTimings&&e.sendUserTimings()})),this.targetWindow=t,this.document=t.document;var s=function(e){return ae(e).config}(t),c=new ce({targetWindow:t}),u=new Ye({targetWindow:t,config:s}),l=new Ke({targetWindow:t}),d=new We({targetWindow:t,config:s,cookieMonsterClient:u,boxViewsMarker:l,sendPerformanceMetrics:this.sendPerformanceMetrics}),h=Qe(t),f=new pt({targetWindow:t,reportError:h}),v=new jt(t),m=new Bt(t,v),g=function(e){var t=e.targetWindow,n=e.reportError,r=e.componentNodesFinder,o=new _e(t,n),i=new De(Object.assign({},e,{serializedPropsFinder:o}));return{public:Object.assign({init:qe(0,r)},i.createPublicAPI()),private:i.createPrivateAPI()}}({targetWindow:t,services:f,reportError:h,componentNodesFinder:v,registerPrototypeCallback:m.onPrototypeRegistered,unmountNodeCallback:l.unmountNode,mountNodeCallback:l.markBoxAsRendered}),b=new ct({reportError:h,allowedPlugins:s.allowedPlugins}),w=new ye({appContext:c,analytics:d,updateComponentCallback:g.private.updateComponentCallback,beforeUpdateComponentCallback:g.private.beforeUpdateComponentCallback}),C={config:s,targetWindow:t,unmountNodeCallback:g.private.unmountNode,mountNodeCallback:g.private.mountNode,updateSerializedPropsCollectionCallback:g.private.updateSerializedPropsCollection,updateComponentNodesCollectionCallback:g.private.updateComponentNodesCollection,updateServicesCallback:f.update,updateAllowedPluginsCallback:b.boundUpdateRegistry,lazyScriptsManager:m},E=new ge({httpClient:r,reportError:h,boxRenderCallback:Ot(C),fragmentRenderCallback:Tt(C)});this.config=s,this.cookieMonsterClient=u,this.boxViewsMarker=l,this.analytics=d,this.services=f,this.componentAPI=g,this.rawDataListenersRegistry=w,this.opboxWebClient=E,this.plugins=b,this.reportError=h,this.lazyScriptsManager=m,this.navigation=new tt({targetWindow:t,opboxWebClient:E,rawDataListenersRegistry:w,reportError:h}),this.edgeClient=new Xe({httpClient:o,edgeHost:s.edgeHost,language:s.language}),this.edgeUploadClient=new Xe({httpClient:o,edgeHost:s.edgeUploadHost,language:s.language}),this.preferencesClient=new wt({edgeClient:this.edgeClient,localStorage:t.localStorage,reportError:h}),this.uiTools=function(e){var t=e.document,n=function(e){return I(e)?O(t,'a[name="'.concat(e,'"]')):null},r=function(n){var r=e.pageYOffset||t.documentElement.scrollTop||0;return n?n.getBoundingClientRect().top+r:null};return{getBoxAnchorNode:n,getTopOffset:r,scrollTo:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o.animate,a=void 0===i||i,s={duration:a?500:0};if("number"!==x(t)){var c=n(t);if(c){var u=r(c);at(e,u,s)}}else at(e,t,s)},tween:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return it.apply(void 0,[e].concat(n))}}}(t),m.handleSSRAssets(),d.initialize(),this.navigation.initialize(),l.initialize()}return o(e,[{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,plugin:this.plugins.createAPI(),onData:this.rawDataListenersRegistry.registerListener,changeParams:this.navigation.navigateRelative,refreshPage:this.navigation.refreshPage,tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),navigation:this.navigation.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper,loaded:!0,performance:ae(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}},{key:"renderBoxForLazyloadedPlaceholders",value:function(){var e=this;C(M(this.document,"[".concat("data-placeholder-for","].lazyloaded")),(function(t){var n=V(t,"data-placeholder-for");return e.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}))}},{key:"updateInlinePreference",value:function(){var e=this.config,t=this.preferencesClient;e.cssBundle&&e.cssBundle.shouldInline&&t.setPreference("receivedInline",!0)}},{key:"broadcastAPILoadEvent",value:function(){q(this.targetWindow,"opboxAPILoaded",this.document)}},{key:"run",value:function(){this.attach(),this.renderBoxForLazyloadedPlaceholders()}}]),e}())(window,ie(),ie());Wt.run();var Ut=Wt.attach;var Lt=Object.freeze({__proto__:null,MIN_ENGAGEMENT_DURATION_IN_MS:2e3,CYCLE_DURATION_IN_MS:6e3,attachEngagementObserver:function(e){var t,n=e.targetWindow,r=e.onCycleComplete,o=Date.now,i=o(),a=function(){return n.innerHeight+(n.scrollY||n.document.documentElement.scrollTop)},s=0,c=0,u=a(),l=null,d=!1,h=function(e,t,n){return e.addEventListener(t,n)},f=function(e){if(l){var t;if(l<s){var n=e-s,r=2e3-(s-l);t=Math.min(n,r)}else{var o=e-l;t=Math.min(o,2e3)}c+=t}},p=function(){return o()-i},v=function(){d=!1;var e,t=p();f(t),(e=a())>u&&(u=e),l=t},m=function(){var e,t,o;e=p(),f(e),c>0&&r({engagementTime:Math.min(c,6e3),scrollBottom:u,pageHeight:(t=n.document,o=t.body,t.documentElement.scrollHeight||o.scrollHeight)}),l<e-2e3&&(l=null),c=0,s=e,u=a()},g=n.document;h(g,"click",v),h(g,"mousemove",v),h(g,"keydown",v),h(g,"scroll",(function(){d||(d=!0,n.requestAnimationFrame(v))})),h(n,"pagehide",(function(){n.clearInterval(t),m()})),h(n,"pageshow",(function(){s=p(),t=n.setInterval(m,6e3)}))}});return e.attach=Ut,e}({});